<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Grocery List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        /* Dark Mode Color Palette */
        :root {
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-color: #e0e0e0;
            --secondary-text-color: #b0b0b0;
            --primary-color: #3b82f6; /* Blue */
            --primary-light-color: #60a5fa;
            --accent-green: #22c55e;
            --accent-yellow: #eab308;
            --accent-red: #ef4444;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .card {
            background-color: var(--surface-color);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -1px var(--shadow-color);
        }
        .btn {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -1px var(--shadow-color);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px -2px var(--shadow-color), 0 4px 6px -2px var(--shadow-color);
        }
        input, button {
            color: #4b5563; /* This changes the text color of the input fields to dark gray */
        }
        input::placeholder {
            color: #4b5563; /* Dark gray placeholder text */
        }
        .editing-item {
            border: 2px solid var(--primary-color);
        }
        .autocomplete-list, .copy-options {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #333;
            border-radius: 0.5rem;
            background-color: var(--surface-color);
            z-index: 10;
        }
        .autocomplete-list div:hover {
            background-color: #2a2a2a;
        }
        /* Modal-specific styling */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background-color: var(--surface-color);
        }
        .text-gray-700 { color: var(--text-color); }
        .text-gray-600 { color: var(--secondary-text-color); }
        .bg-gray-100 { background-color: #2e2e2e; }
        .border-gray-300 { border-color: #444; }
        
        .bg-blue-500 { background-color: var(--primary-color); }
        .hover\:bg-blue-600:hover { background-color: var(--primary-light-color); }
        .bg-green-500 { background-color: var(--accent-green); }
        .hover\:bg-green-600:hover { background-color: #15803d; }
        .bg-yellow-500 { background-color: var(--accent-yellow); }
        .hover\:bg-yellow-600:hover { background-color: #a16207; }
        .bg-red-500 { background-color: var(--accent-red); }
        .hover\:bg-red-600:hover { background-color: #b91c1c; }
        .bg-gray-300 { background-color: #4b5563; }
        .hover\:bg-gray-400:hover { background-color: #6b7280; }
        .bg-blue-400 { background-color: #60a5fa; }
        .hover\:bg-blue-500:hover { background-color: #3b82f6; }
        .text-red-500 { color: var(--accent-red); }
        .text-white { color: var(--text-color); }
        .list-item-text {
            color: #4b5563; /* Dark gray for list item text */
            font-size: 1.125rem; /* Slightly larger text */
        }
        .timestamp-text {
            color: white;
        }
        .dark-gray-text {
            color: #4b5563;
        }
    </style>
</head>
<body class="p-4">

    <main class="container mx-auto p-4 md:p-8">
        <header class="flex items-center justify-center mb-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-500 mr-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.706.707 1.706H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <h1 class="text-4xl md:text-5xl font-bold text-gray-700">Modern Grocery List</h1>
        </header>

        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 card p-6" role="region" aria-labelledby="current-list-heading">
                <h2 id="current-list-heading" class="text-2xl font-semibold text-gray-700 mb-4">Current List</h2>

                <form id="addItemForm" class="flex flex-col sm:flex-row gap-4 mb-6">
                    <label for="itemInput" class="sr-only">New grocery item</label>
                    <input type="text" id="itemInput" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-surface" placeholder="Enter a new grocery item">

                    <label for="quantityInput" class="sr-only">Item quantity</label>
                    <input type="number" id="quantityInput" class="w-20 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-surface" value="1" min="1">

                    <button type="submit" id="addItemBtn" class="btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg sm:w-36">Add Item</button>
                </form>

                <ul id="currentList" class="space-y-3" role="list">
                    </ul>

                <div id="clearListBtnContainer" class="flex justify-center mt-6 hidden">
                    <button id="clearListBtn" class="btn bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-2 px-4 rounded-lg">Clear List</button>
                </div>

                <hr class="my-6 border-gray-300">

                <h2 class="text-2xl font-semibold dark-gray-text mb-4">Save List</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="relative flex-grow">
                        <label for="listNameInput" class="sr-only">List Name</label>
                        <input type="text" id="listNameInput" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 bg-surface" placeholder="Supermarket Name" autocomplete="off" aria-autocomplete="list" aria-controls="autocompleteContainer">
                        <div id="autocompleteContainer" class="absolute w-full mt-1 autocomplete-list shadow-lg hidden" role="listbox"></div>
                        <p id="nameWarning" class="text-sm text-red-500 mt-2 hidden" aria-live="polite">Please type at least three letters to see suggestions.</p>
                    </div>
                    <button id="saveListBtn" class="btn bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg sm:w-36">Save List</button>
                </div>

                <div id="messageAlert" role="alert" class="mt-4 p-4 rounded-lg text-white font-semibold hidden"></div>
            </div>

            <div class="card p-6" role="region" aria-labelledby="saved-lists-heading">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="saved-lists-heading" class="text-2xl font-semibold text-gray-700">Saved Lists</h2>
                </div>
                <div id="savedListsContainer" class="space-y-3">
                    </div>
            </div>
        </section>
    </main>

    <div id="deleteModal" class="fixed inset-0 flex items-center justify-center hidden z-50 modal-overlay" role="dialog" aria-modal="true" aria-labelledby="deleteModalHeading">
        <div class="card p-6 w-full max-w-sm modal-content" role="document">
            <h3 id="deleteModalHeading" class="text-xl font-bold mb-4">Confirm Deletion</h3>
            <p class="text-gray-700 mb-6">Are you sure you want to delete this grocery list? This action cannot be undone.</p>
            <div class="flex justify-end space-x-4">
                <button id="cancelDeleteBtn" class="btn bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-2 px-4 rounded-lg">Cancel</button>
                <button id="confirmDeleteBtn" class="btn bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg" data-list-name="">Delete</button>
            </div>
        </div>
    </div>

    <div id="clearListModal" class="fixed inset-0 flex items-center justify-center hidden z-50 modal-overlay" role="dialog" aria-modal="true" aria-labelledby="clearListModalHeading">
        <div class="card p-6 w-full max-w-sm modal-content" role="document">
            <h3 id="clearListModalHeading" class="text-xl font-bold mb-4">Confirm Clear List</h3>
            <p class="text-gray-700 mb-6">Are you sure you want to clear your current grocery list? This action cannot be undone.</p>
            <div class="flex justify-end space-x-4">
                <button id="cancelClearBtn" class="btn bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-2 px-4 rounded-lg">Cancel</button>
                <button id="confirmClearBtn" class="btn bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg">Clear</button>
            </div>
        </div>
    </div>

    <div id="copyOptionsModal" class="fixed inset-0 flex items-center justify-center hidden z-50 modal-overlay" role="dialog" aria-modal="true" aria-labelledby="copyOptionsModalHeading">
        <div class="card p-6 w-full max-w-sm modal-content" role="document">
            <h3 id="copyOptionsModalHeading" class="text-xl font-bold mb-4">Copy List As...</h3>
            <div class="flex flex-col space-y-4">
                <button class="btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg" data-format="simple">Simple List</button>
                <button class="btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg" data-format="checkbox">With Checkboxes</button>
                <a id="notesAppLink" class="btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg" href="#" role="button">Save to Notes App</a>
            </div>
            <div class="flex justify-end mt-6">
                <button id="cancelCopyBtn" class="btn bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-2 px-4 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>

    <footer class="mt-8 py-4 text-center text-gray-600 text-sm">
        <p>&copy; 2025 Modern Grocery List. All rights reserved.</p>
    </footer>

    <script type="module">
        // Get references to all the necessary HTML elements
        const itemInput = document.getElementById('itemInput');
        const quantityInput = document.getElementById('quantityInput');
        const addItemBtn = document.getElementById('addItemBtn');
        const addItemForm = document.getElementById('addItemForm');
        const currentListElement = document.getElementById('currentList');
        const clearListBtn = document.getElementById('clearListBtn');
        const clearListBtnContainer = document.getElementById('clearListBtnContainer');
        const listNameInput = document.getElementById('listNameInput');
        const autocompleteContainer = document.getElementById('autocompleteContainer');
        const nameWarning = document.getElementById('nameWarning');
        const saveListBtn = document.getElementById('saveListBtn');
        const savedListsContainer = document.getElementById('savedListsContainer');
        const messageAlert = document.getElementById('messageAlert');
        const notesAppLink = document.getElementById('notesAppLink');

        // Modals and their elements
        const deleteModal = document.getElementById('deleteModal');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const clearListModal = document.getElementById('clearListModal');
        const cancelClearBtn = document.getElementById('cancelClearBtn');
        const confirmClearBtn = document.getElementById('confirmClearBtn');
        const copyOptionsModal = document.getElementById('copyOptionsModal');
        const cancelCopyBtn = document.getElementById('cancelCopyBtn');

        let currentList = [];
        let editingIndex = -1; // -1 indicates no item is being edited
        let isOnline = navigator.onLine;
        const originalPlaceholder = listNameInput.placeholder;

        // Add `sr-only` class to visually hide elements but make them available to screen readers
        const srOnlyStyle = document.createElement('style');
        srOnlyStyle.textContent = '.sr-only { border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px; }';
        document.head.appendChild(srOnlyStyle);

        const groceryStores = [
            "Walmart", "Kroger", "Albertsons", "Publix", "Whole Foods Market",
            "Trader Joe's", "Aldi", "Costco", "Sam's Club", "Target",
            "H-E-B", "Wegmans", "Safeway", "Meijer", "Sprouts Farmers Market",
            "Fresh Market", "Hy-Vee", "Food Lion", "Stop & Shop", "Giant Food",
            "Harris Teeter", "WinCo Foods", "Lidl", "Save A Lot", "Raley's",
            "Schnucks", "ShopRite", "Stater Bros. Markets", "Fred Meyer", "Vons",
            "Loblaws", "Metro", "Sobeys", "IGA", "Food Basics", "No Frills",
            "Real Canadian Superstore", "Safeway (Canada)", "Thrifty Foods",
            "Save-On-Foods", "Frescho", "Co-op", "Bulk Barn", "Adonis",
            "Super C", "Farm Boy", "Foodland", "FreshCo", "Longos",
            "Chedraui", "Soriana", "La Comer", "HEB (Mexico)", "Calimax",
            "Ley", "Casa Ley", "Mercado Soriana", "Fresko", "Superama",
            "City Market", "Aki", "Supermercados", "Comercial Mexicana", "Costco (Mexico)"
        ].sort();

        // Initialize the app
        async function initializeApp() {
            try {
                console.log("App initialized in offline mode");
                renderCurrentList();
                renderSavedListsFromLocal();
                updateAddItemButton();
                toggleClearButton();
                showMessage("App loaded successfully! Working in offline mode.", 'success');
                itemInput.focus(); // Set focus to the item input on load for better UX
            } catch (error) {
                console.error("Error initializing app:", error);
                showMessage("Error initializing app. Working in offline mode.", 'error');
            }
        }

        // Function to show messages to the user
        function showMessage(message, type) {
            messageAlert.textContent = message;
            messageAlert.className = `mt-4 p-4 rounded-lg text-white font-semibold ${
                type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' :
                type === 'blue' ? 'bg-blue-500' : 'bg-gray-500'
            }`;
            messageAlert.classList.remove('hidden');

            setTimeout(() => {
                messageAlert.classList.add('hidden');
            }, 5000);
        }

        // Function to render the current list
        function renderCurrentList() {
            currentListElement.innerHTML = '';
            currentList.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = `flex items-center justify-between p-3 bg-gray-100 rounded-lg ${editingIndex === index ? 'editing-item' : ''}`;
                li.innerHTML = `
                    <span class="flex-grow list-item-text">${item.quantity} x ${item.name}</span>
                    <div class="flex space-x-2">
                        <button class="btn bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-1 px-2 rounded text-sm" data-action="edit-item" data-index="${index}" aria-label="Edit item: ${item.name}">Edit</button>
                        <button class="btn bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-2 rounded text-sm" data-action="delete-item" data-index="${index}" aria-label="Delete item: ${item.name}">Delete</button>
                    </div>
                `;
                currentListElement.appendChild(li);
            });
        }

        // Function to render saved lists from localStorage
        function renderSavedListsFromLocal() {
            const savedLists = JSON.parse(localStorage.getItem('groceryLists')) || {};
            savedListsContainer.innerHTML = '';

            if (Object.keys(savedLists).length === 0) {
                savedListsContainer.innerHTML = '<p class="text-gray-600 text-center">No saved lists yet.</p>';
                return;
            }

            Object.entries(savedLists).forEach(([listName, listData]) => {
                // Format the timestamp for display
                const date = new Date(listData.timestamp);
                const formattedDate = date.toLocaleString('en-US', {
                    month: 'long',
                    day: 'numeric',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    hour12: true
                });

                const listElement = document.createElement('div');
                listElement.className = 'card p-4 mb-3';
                listElement.innerHTML = `
                    <h3 class="font-semibold text-lg mb-1">${listName}</h3>
                    <p class="text-gray-600 text-sm"><span class="list-item-text">${listData.items.length} items</span> • <span class="timestamp-text">Last saved: ${formattedDate}</span></p>
                    <div class="flex flex-wrap gap-2 mt-3">
                        <button class="btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1 px-3 rounded text-sm" data-action="load" data-list-name="${listName}" aria-label="View list ${listName}">View</button>
                        <button class="btn bg-green-500 hover:bg-green-600 text-white font-semibold py-1 px-3 rounded text-sm" data-action="edit" data-list-name="${listName}" aria-label="Edit list ${listName}">Edit</button>
                        <button class="btn bg-blue-400 hover:bg-blue-500 text-white font-semibold py-1 px-3 rounded text-sm" data-action="share" data-list-name="${listName}" aria-label="Share list ${listName}">Share</button>
                        <button class="btn bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-3 rounded text-sm" data-action="delete" data-list-name="${listName}" aria-label="Delete list ${listName}">Delete</button>
                    </div>
                `;
                savedListsContainer.appendChild(listElement);
            });
        }

        // Function to update the Add Item button text based on editing state
        function updateAddItemButton() {
            if (editingIndex >= 0) {
                addItemBtn.textContent = 'Update Item';
                addItemBtn.className = 'btn bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-4 rounded-lg sm:w-36';
            } else {
                addItemBtn.textContent = 'Add Item';
                addItemBtn.className = 'btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg sm:w-36';
            }
        }

        // Function to toggle the visibility of the Clear List button
        function toggleClearButton() {
            if (currentList.length > 0) {
                clearListBtnContainer.classList.remove('hidden');
            } else {
                clearListBtnContainer.classList.add('hidden');
            }
        }

        // Function to copy text to clipboard
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                showMessage('List copied to clipboard!', 'success');
            } catch (err) {
                console.error('Failed to copy: ', err);
                showMessage('Failed to copy to clipboard.', 'error');
            }
        }

        // Event listener for adding or updating an item
        addItemForm.addEventListener('submit', (event) => {
            event.preventDefault(); // Prevent page reload
            const item = itemInput.value.trim();
            const quantity = parseInt(quantityInput.value);

            if (!item) {
                showMessage('Please enter an item name.', 'error');
                itemInput.focus();
                return;
            }

            if (editingIndex >= 0) {
                // Update existing item
                currentList[editingIndex] = { name: item, quantity: quantity };
                editingIndex = -1; // Reset editing mode
                showMessage('Item updated successfully!', 'success');
            } else {
                // Add new item
                if (currentList.find(i => i.name.toLowerCase() === item.toLowerCase())) {
                    showMessage('This item is already in your list.', 'error');
                    itemInput.focus();
                    return;
                }
                currentList.push({ name: item, quantity: quantity });
                showMessage('Item added successfully!', 'success');
            }

            itemInput.value = '';
            quantityInput.value = '1';
            renderCurrentList();
            updateAddItemButton();
            toggleClearButton();
            itemInput.focus();
        });

        // Event listener to remove placeholder on focus
        listNameInput.addEventListener('focus', () => {
            listNameInput.placeholder = '';
        });

        // Event listener to restore placeholder on blur if empty
        listNameInput.addEventListener('blur', () => {
            if (!listNameInput.value) {
                listNameInput.placeholder = originalPlaceholder;
            }
        });

        // Event listener for autocomplete functionality
        listNameInput.addEventListener('input', () => {
            const query = listNameInput.value.toLowerCase();
            autocompleteContainer.innerHTML = '';

            if (query.length < 3) {
                autocompleteContainer.classList.add('hidden');
                nameWarning.classList.remove('hidden');
                return;
            }

            nameWarning.classList.add('hidden');
            const filteredStores = groceryStores.filter(store =>
                store.toLowerCase().includes(query)
            );

            if (filteredStores.length > 0) {
                autocompleteContainer.classList.remove('hidden');
                filteredStores.forEach(store => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'p-2 cursor-pointer hover:bg-gray-200';
                    suggestion.textContent = store;
                    suggestion.setAttribute('role', 'option');
                    suggestion.setAttribute('tabindex', '0');
                    suggestion.addEventListener('click', () => {
                        listNameInput.value = store;
                        autocompleteContainer.classList.add('hidden');
                    });
                    autocompleteContainer.appendChild(suggestion);
                });
            } else {
                autocompleteContainer.classList.add('hidden');
            }
        });

        // Event listener for saving the current list
        saveListBtn.addEventListener('click', async () => {
            const listName = listNameInput.value.trim();
            if (!listName) {
                showMessage('Please enter a name for your list.', 'error');
                listNameInput.focus();
                return;
            }
            if (currentList.length === 0) {
                showMessage('Your list is empty. Add some items first!', 'error');
                itemInput.focus();
                return;
            }

            // Prepare data for storage
            const listData = {
                items: currentList,
                timestamp: new Date().toISOString()
            };

            // Save to localStorage
            const localLists = JSON.parse(localStorage.getItem('groceryLists')) || {};
            localLists[listName] = listData;
            localStorage.setItem('groceryLists', JSON.stringify(localLists));

            currentList = []; // Clear the current list after saving
            listNameInput.value = '';
            editingIndex = -1; // Reset editing mode
            renderCurrentList();
            renderSavedListsFromLocal();
            updateAddItemButton();
            toggleClearButton();
            showMessage(`List "${listName}" saved successfully!`, 'success');
            itemInput.focus();
        });

        // Function to delete a list
        async function deleteList(listName) {
            // Delete from localStorage
            const localLists = JSON.parse(localStorage.getItem('groceryLists')) || {};
            delete localLists[listName];
            localStorage.setItem('groceryLists', JSON.stringify(localLists));

            renderSavedListsFromLocal();
            showMessage(`List "${listName}" deleted successfully.`, 'success');
        }

        // Event listener for interacting with saved lists
        savedListsContainer.addEventListener('click', async (event) => {
            const targetButton = event.target.closest('button');
            if (!targetButton) return;

            const listName = targetButton.getAttribute('data-list-name');
            const action = targetButton.getAttribute('data-action');
            const savedLists = JSON.parse(localStorage.getItem('groceryLists')) || {};
            const listData = savedLists[listName];

            if (action === 'load') {
                currentList = listData?.items || [];
                renderCurrentList();
                listNameInput.value = ''; // Clear the list name input
                editingIndex = -1; // Reset editing mode
                updateAddItemButton();
                toggleClearButton();
                showMessage(`List "${listName}" loaded.`, 'success');
                itemInput.focus();
            } else if (action === 'edit') {
                currentList = listData?.items || [];
                renderCurrentList();
                listNameInput.value = listName; // Pre-fill the input with the list name
                editingIndex = -1; // Reset editing mode
                updateAddItemButton();
                toggleClearButton();
                showMessage(`List "${listName}" loaded for editing.`, 'success');
                itemInput.focus();
            } else if (action === 'delete') {
                deleteModal.classList.remove('hidden');
                confirmDeleteBtn.setAttribute('data-list-name', listName);
                deleteModal.focus(); // Focus on the modal for accessibility
            } else if (action === 'share') {
                if (navigator.share && listData) {
                    const listItems = listData.items.map(item => `${item.quantity} x ${item.name}`).join('\n');
                    const shareText = `My Grocery List: ${listName}\n\n${listItems}`;
                    try {
                        await navigator.share({
                            title: `Grocery List: ${listName}`,
                            text: shareText
                        });
                        showMessage('List shared successfully!', 'success');
                    } catch (error) {
                        console.error('Sharing failed:', error);
                        showMessage('Failed to share the list.', 'error');
                    }
                } else {
                    showMessage('Sharing is not supported on this device or list not found.', 'error');
                }
            }
        });

        // Event listener for deleting or editing an item from the current list
        currentListElement.addEventListener('click', (event) => {
            const targetButton = event.target.closest('button');
            if (!targetButton) return;

            const index = parseInt(targetButton.getAttribute('data-index'));
            const action = targetButton.getAttribute('data-action');

            if (action === 'delete-item') {
                currentList.splice(index, 1);
                editingIndex = -1; // Reset editing mode
                renderCurrentList();
                updateAddItemButton();
                toggleClearButton();
                showMessage('Item deleted successfully!', 'success');
            } else if (action === 'edit-item') {
                itemInput.value = currentList[index].name;
                quantityInput.value = currentList[index].quantity;
                editingIndex = index; // Set the index of the item being edited
                renderCurrentList();
                updateAddItemButton();
                itemInput.focus();
            }
        });

        // Event listeners for the confirmation modals
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.add('hidden');
        });

        confirmDeleteBtn.addEventListener('click', () => {
            const listName = confirmDeleteBtn.getAttribute('data-list-name');
            if (listName) {
                deleteList(listName);
            }
            deleteModal.classList.add('hidden');
        });

        cancelClearBtn.addEventListener('click', () => {
            clearListModal.classList.add('hidden');
        });

        confirmClearBtn.addEventListener('click', () => {
            currentList = [];
            editingIndex = -1;
            renderCurrentList();
            updateAddItemButton();
            toggleClearButton();
            showMessage('List cleared successfully!', 'success');
            clearListModal.classList.add('hidden');
        });

        // Event listeners for the Copy Options modal
        copyOptionsModal.addEventListener('click', async (event) => {
            const targetButton = event.target.closest('button, a');
            if (!targetButton || targetButton.id === 'cancelCopyBtn') {
                copyOptionsModal.classList.add('hidden');
                return;
            }

            const listName = copyOptionsModal.getAttribute('data-list-name');
            const savedLists = JSON.parse(localStorage.getItem('groceryLists')) || {};
            const listData = savedLists[listName];
            let copyText = '';

            if (listData) {
                const format = targetButton.getAttribute('data-format');
                if (format === 'simple') {
                    copyText = listData.items.map(item => `- ${item.quantity} x ${item.name}`).join('\n');
                    copyToClipboard(copyText);
                } else if (format === 'checkbox') {
                    copyText = listData.items.map(item => `[ ] ${item.quantity} x ${item.name}`).join('\n');
                    copyToClipboard(copyText);
                } else if (targetButton.id === 'notesAppLink') {
                    const notesText = listData.items.map(item => `- ${item.quantity} x ${item.name}`).join('\n');
                    const notesTitle = `Grocery List: ${listName}`;
                    const url = `data:text/plain;charset=utf-8,${encodeURIComponent(notesTitle + '\n\n' + notesText)}`;
                    window.open(url, '_blank');
                    showMessage('Notes app will open with the list.', 'success');
                }
                copyOptionsModal.classList.add('hidden');
            } else {
                showMessage('List not found.', 'error');
            }
        });

        // Close modal when clicking outside or pressing Escape key
        document.addEventListener('click', (event) => {
            if (event.target === deleteModal) {
                deleteModal.classList.add('hidden');
            }
            if (event.target === clearListModal) {
                clearListModal.classList.add('hidden');
            }
            if (event.target === copyOptionsModal) {
                copyOptionsModal.classList.add('hidden');
            }
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                deleteModal.classList.add('hidden');
                clearListModal.classList.add('hidden');
                copyOptionsModal.classList.add('hidden');
            }
        });

        // Offline/Online status detection
        window.addEventListener('offline', () => {
            isOnline = false;
            showMessage("You are now offline. Changes will be saved locally.", 'blue');
        });

        window.addEventListener('online', () => {
            isOnline = true;
            showMessage("You are now online.", 'success');
        });

        // Initialize the app when the page loads
        initializeApp();
    </script>
</body>
</html>
